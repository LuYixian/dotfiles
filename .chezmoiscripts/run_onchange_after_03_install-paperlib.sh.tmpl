{{ if eq .platform "darwin" -}}
#!/bin/bash

set -eufo pipefail

# define the URL of the latest Paperlib release
{{ $arch := "arm" -}}
{{ if eq .chezmoi.arch "amd64" -}}{{ $arch = "x64" -}}{{ end -}}
DMG_URL="https://distribution.paperlib.app/electron-mac-{{ $arch }}/latest.dmg"
TEMP_DMG="/tmp/latest.dmg"

# download the latest Paperlib release
curl -L "$DMG_URL" -o "$TEMP_DMG"

# mount the dmg file
VOLUME=$(hdiutil attach "$TEMP_DMG" | grep Volumes | awk '{print $3,$4,$5,$6}' | sed 's/ *$//')

echo "Mounted at: $VOLUME"

# find the app in the mounted volume
APP_NAME=$(ls "$VOLUME" | grep '\.app$' | head -n 1)
echo "ðŸ“¦ Installing $APP_NAME..."
cp -R "$VOLUME/$APP_NAME" /Applications/

# unmount the volume
hdiutil detach "$VOLUME"

# remove the downloaded dmg file
rm "$TEMP_DMG"

echo "Installation completed."

{{ end -}}