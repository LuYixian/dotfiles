# tmux configuration
# Dracula-inspired with vi keybindings

# ─────────────────────────────────────────────────────────────
# Terminal & Display
# ─────────────────────────────────────────────────────────────
set -g default-terminal "tmux-256color"
set -ga terminal-features ",*256col*:RGB"
set -ga terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set -ga terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # undercurl colors

# ─────────────────────────────────────────────────────────────
# General Settings
# ─────────────────────────────────────────────────────────────
set -g base-index 1              # Start window numbering at 1
set -g pane-base-index 1         # Start pane numbering at 1
set -g renumber-windows on       # Renumber windows when one is closed
set -g history-limit 10000       # Scrollback buffer
set -g escape-time 0             # No delay for escape key
set -g display-time 2000         # Status message display time
set -g mouse on                  # Enable mouse support
set -g status-keys vi            # Vi keys in command prompt
set -g mode-keys vi              # Vi keys in copy mode
set -g automatic-rename on       # Auto rename windows
set -g automatic-rename-format '#{pane_current_command}'

# ─────────────────────────────────────────────────────────────
# Prefix Key
# ─────────────────────────────────────────────────────────────
# Use Ctrl+a as prefix (like screen)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# ─────────────────────────────────────────────────────────────
# Window & Pane Management
# ─────────────────────────────────────────────────────────────
# New window/pane in current path
bind c new-window -c "#{pane_current_path}"
bind - split-window -vc "#{pane_current_path}"
bind | split-window -hc "#{pane_current_path}"
bind \\ split-window -hc "#{pane_current_path}"

# Vim-like pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Swap panes
bind > swap-pane -D
bind < swap-pane -U

# Kill pane/window
bind x kill-pane
bind X kill-window

# ─────────────────────────────────────────────────────────────
# Copy Mode (Vi style)
# ─────────────────────────────────────────────────────────────
bind a copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi V send-keys -X select-line
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Escape send-keys -X cancel

# Mouse copy
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# ─────────────────────────────────────────────────────────────
# Misc
# ─────────────────────────────────────────────────────────────
# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Toggle synchronize panes
bind S set-window-option synchronize-panes

# ─────────────────────────────────────────────────────────────
# Session Management
# ─────────────────────────────────────────────────────────────
# Session switcher with fzf
bind C-j display-popup -E "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"

# New session
bind C-n command-prompt -p "New session:" "new-session -s '%%'"

# Kill session
bind C-x confirm-before -p "Kill session #S? (y/n)" kill-session

# ─────────────────────────────────────────────────────────────
# Popup Windows (tmux 3.2+)
# ─────────────────────────────────────────────────────────────
# Popup terminal
bind ` display-popup -E -w 80% -h 80%

# Popup lazygit
bind g display-popup -E -w 90% -h 90% "lazygit"

# Popup htop
bind t display-popup -E -w 80% -h 80% "htop"

# ─────────────────────────────────────────────────────────────
# Dracula Theme Colors
# ─────────────────────────────────────────────────────────────
# Pane borders
set -g pane-border-style fg='#6272a4'
set -g pane-active-border-style fg='#ff79c6'

# Status bar
set -g status-style bg='#282a36',fg='#f8f8f2'
set -g status-interval 1

# Status left
set -g status-left-length 40
set -g status-left '#[fg=#282a36,bg=#bd93f9,bold] #S #[fg=#bd93f9,bg=#282a36]'

# Status right
set -g status-right-length 100
set -g status-right '#[fg=#44475a]#[fg=#f8f8f2,bg=#44475a] %Y-%m-%d #[fg=#bd93f9]#[fg=#282a36,bg=#bd93f9,bold] %H:%M '

# Window status
set -g window-status-format '#[fg=#6272a4] #I:#W '
set -g window-status-current-format '#[fg=#282a36,bg=#50fa7b] #I:#W #[fg=#50fa7b,bg=#282a36]'

# Message style
set -g message-style bg='#44475a',fg='#f8f8f2'
