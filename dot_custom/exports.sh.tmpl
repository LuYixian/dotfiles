# shellcheck shell=bash

# Terminal color support (ensure true color works over SSH)
export TERM=xterm-256color
export COLORTERM=truecolor

# Dracula color palette (used for FZF_DEFAULT_OPTS below)
DRACULA_BG="#282a36"
DRACULA_FG="#f8f8f2"
DRACULA_SELECTION="#44475a"
DRACULA_COMMENT="#6272a4"
DRACULA_CYAN="#8be9fd"
DRACULA_GREEN="#50fa7b"
DRACULA_ORANGE="#ffb86c"
DRACULA_PINK="#ff79c6"
DRACULA_PURPLE="#bd93f9"
DRACULA_RED="#ff5555"
DRACULA_YELLOW="#f1fa8c"

# fzf configuration with Dracula theme
export FZF_DEFAULT_OPTS="
  --color=fg:${DRACULA_FG},bg:${DRACULA_BG},hl:${DRACULA_PURPLE}
  --color=fg+:${DRACULA_FG},bg+:${DRACULA_SELECTION},hl+:${DRACULA_CYAN}
  --color=info:${DRACULA_ORANGE},prompt:${DRACULA_GREEN},pointer:${DRACULA_PINK}
  --color=marker:${DRACULA_CYAN},spinner:${DRACULA_PURPLE},header:${DRACULA_COMMENT}
  --color=border:${DRACULA_COMMENT}
  --color=query:${DRACULA_YELLOW},disabled:${DRACULA_RED}
  --height=60%
  --layout=reverse
  --border=rounded
  --margin=1
  --padding=1
  --info=inline
  --separator='─'
  --preview-window='right:50%:border-left'
"

# Use fd for file searching (respects .gitignore)
if command -v fd >/dev/null 2>&1; then
  export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'
  export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
  export FZF_ALT_C_COMMAND='fd --type d --hidden --follow --exclude .git'
fi

# Preview with bat for CTRL-T (file search)
if command -v bat >/dev/null 2>&1; then
  export FZF_CTRL_T_OPTS="
    --preview 'bat --color=always --style=numbers --line-range=:500 {}'
    --preview-window='right:60%:border-left'
    --bind 'ctrl-/:toggle-preview'
  "
fi

# Preview directories with eza for ALT-C (cd)
if command -v eza >/dev/null 2>&1; then
  export FZF_ALT_C_OPTS="
    --preview 'eza --tree --level=2 --color=always --icons {}'
    --preview-window='right:50%:border-left'
  "
fi

# CTRL-R history search options
export FZF_CTRL_R_OPTS="
  --preview 'echo {}'
  --preview-window='down:3:wrap'
  --bind 'ctrl-y:execute-silent(echo -n {2..} | pbcopy)+abort'
  --header 'Press CTRL-Y to copy command'
"

# AI commit message provider (codex, gemini, claude, auto)
# Override in ~/.custom/local.sh if needed
export AICOMMIT_PROVIDER="${AICOMMIT_PROVIDER:-codex}"

# ─────────────────────────────────────────────────────────────
# TMux plugin configuration (ohmyzsh/plugins/tmux)
# Must be set before sheldon loads the plugin
# ─────────────────────────────────────────────────────────────
export ZSH_TMUX_CONFIG="$HOME/.config/tmux/tmux.conf"
# Disable tmux autostart in VSCode (avoids status bar stacking with Claude CLI)
if [[ "$TERM_PROGRAM" == "vscode" ]]; then
  export ZSH_TMUX_AUTOSTART=false
  export ZSH_TMUX_AUTOCONNECT=false
else
  export ZSH_TMUX_AUTOSTART=true
  export ZSH_TMUX_AUTOCONNECT=true
fi
export ZSH_TMUX_AUTOQUIT=false
# TMux session name based on aerospace workspace
# Each workspace gets its own session (ws-1, ws-2, etc.)
# Falls back to "main" if aerospace unavailable or outside workspace
if command -v aerospace >/dev/null 2>&1; then
  _ws=$(aerospace list-workspaces --focused 2>/dev/null)
  if [[ -n "$_ws" ]]; then
    export ZSH_TMUX_DEFAULT_SESSION_NAME="ws-${_ws}"
  else
    export ZSH_TMUX_DEFAULT_SESSION_NAME="main"
  fi
  unset _ws
else
  export ZSH_TMUX_DEFAULT_SESSION_NAME="main"
fi
{{- if eq .chezmoi.os "darwin" }}

# ─────────────────────────────────────────────────────────────
# Hammerspoon configuration directory (macOS only)
# Use ~/.config/hammerspoon instead of default ~/.hammerspoon
# ─────────────────────────────────────────────────────────────
export HS_CONFIG_DIR="$HOME/.config/hammerspoon"
{{- end }}
